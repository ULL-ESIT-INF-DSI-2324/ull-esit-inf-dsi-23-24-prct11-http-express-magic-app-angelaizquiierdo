<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>ull-esit-inf-dsi-23-24-prct11-http-express-magic-app-angelaizquiierdo</title><meta name="description" content="Documentation for ull-esit-inf-dsi-23-24-prct11-http-express-magic-app-angelaizquiierdo"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">ull-esit-inf-dsi-23-24-prct11-http-express-magic-app-angelaizquiierdo</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>ull-esit-inf-dsi-23-24-prct11-http-express-magic-app-angelaizquiierdo</h2></div><div class="tsd-panel tsd-typography"><p><a href="https://classroom.github.com/a/sNC2m9MU"><img src="https://classroom.github.com/assets/deadline-readme-button-24ddc0f5d75046c5622901739e7c5dd533143b0c8e959d652212380cedb1ea36.svg" alt="Review Assignment Due Date"></a></p>
<a id="md:práctica-11---aplicación-express-para-coleccionistas-de-cartas-magic" class="tsd-anchor"></a><h1><a href="#md:práctica-11---aplicación-express-para-coleccionistas-de-cartas-magic">Práctica 11 - Aplicación Express para coleccionistas de cartas Magic</a></h1><a id="md:indice" class="tsd-anchor"></a><h2><a href="#md:indice">Indice</a></h2><a id="md:introducción" class="tsd-anchor"></a><h2><a href="#md:introducción">Introducción</a></h2><p>Basado en práctica 10 de servidor-cliente de API para coleccionistas de cartas Magic, usando <strong>Express</strong> para gestionar las carta mágicas con las funciones implementadas mediante funciones callback de forma asincrona el sistema de gestion de ficheros. Las peticiones que podrá realizar el cliente al servidor deberán permitir añadir, modificar, eliminar, listar y mostrar cartas de un usuario concreto. El servidor Express deberá almacenar la información de las cartas como ficheros JSON en el sistema de ficheros, siguiendo la misma estructura de directorios utilizada durante prácticas pasadas.</p>
<a id="md:desarrollo-de-la-práctica" class="tsd-anchor"></a><h2><a href="#md:desarrollo-de-la-práctica">Desarrollo de la práctica</a></h2><p>En la práctica anterior con las funciones asincronas y empreando el patron callback las funciones que suefieron cambio fueron <code>GuardarCarta</code> y <code>ActualizarCarta</code>.</p>
<p>La función <code>GuardarCarta</code>, donde se había omitido la consideración de manejar la situación en la que el archivo de la carta ya existía en el directorio del usuario.</p>
<p>Para abordar esta omisión, implementé una verificación adicional para determinar la existencia del archivo. En caso de que el archivo ya estuviera presente, se agregó una instrucción dentro del callback para devolver un mensaje de error.</p>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-3">GuardarCarta</span><span class="hl-1"> = (</span><br/><span class="hl-1">  </span><span class="hl-4">usuario</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">carta</span><span class="hl-1">: </span><span class="hl-5">Carta</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-3">callback</span><span class="hl-1">: (</span><span class="hl-4">err</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1"> | </span><span class="hl-5">undefined</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1"> | </span><span class="hl-5">undefined</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-5">void</span><span class="hl-1">,</span><br/><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">directorioUsuario</span><span class="hl-1"> = </span><span class="hl-7">`./cartas/</span><span class="hl-2">${</span><span class="hl-4">usuario</span><span class="hl-2">}</span><span class="hl-7">`</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">rutaCarta</span><span class="hl-1"> = </span><span class="hl-7">`</span><span class="hl-2">${</span><span class="hl-4">directorioUsuario</span><span class="hl-2">}</span><span class="hl-7">/</span><span class="hl-2">${</span><span class="hl-4">carta</span><span class="hl-8">.</span><span class="hl-4">id</span><span class="hl-2">}</span><span class="hl-7">.json`</span><span class="hl-1">;</span><br/><br/><span class="hl-1">  </span><span class="hl-9">// Verificar si el archivo ya existe</span><br/><span class="hl-1">  </span><span class="hl-4">fs</span><span class="hl-1">.</span><span class="hl-3">access</span><span class="hl-1">(</span><span class="hl-4">rutaCarta</span><span class="hl-1">, </span><span class="hl-4">fs</span><span class="hl-1">.</span><span class="hl-4">constants</span><span class="hl-1">.</span><span class="hl-6">F_OK</span><span class="hl-1">, (</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">err</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-9">// Si el archivo ya existe, devolver un mensaje de error</span><br/><span class="hl-1">      </span><span class="hl-3">callback</span><span class="hl-1">(</span><span class="hl-7">`El archivo para la carta </span><span class="hl-2">${</span><span class="hl-4">carta</span><span class="hl-8">.</span><span class="hl-4">nombre</span><span class="hl-2">}</span><span class="hl-7"> ya existe`</span><span class="hl-1">, </span><span class="hl-2">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">       ...</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">};</span><br/>
</code><button>Copy</button></pre>
<p>En el caso de la función <code>ActualizarCarta</code>, realicé una mejora significativa al eliminar la llamada a la función <code>GuardarCarta</code>. Anteriormente, esta llamada podía crear un nuevo archivo en el directorio del usuario, lo cual era problemático ya que no se verificaba si el usuario era el propietario del archivo o si el archivo pertenecía a otro usuario. Esto podría resultar en una situación ambigua y posiblemente generar confusiones en el sistema.</p>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-3">ActualizarCarta</span><span class="hl-1"> = (</span><br/><span class="hl-1">  </span><span class="hl-4">usuario</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">id</span><span class="hl-1">: </span><span class="hl-5">number</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">nuevaCarta</span><span class="hl-1">: </span><span class="hl-5">Carta</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-3">callback</span><span class="hl-1">: (</span><span class="hl-4">error</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1"> | </span><span class="hl-5">undefined</span><span class="hl-1">, </span><span class="hl-4">data</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1"> | </span><span class="hl-5">undefined</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-5">void</span><span class="hl-1">,</span><br/><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  ...</span><br/><span class="hl-1">        </span><span class="hl-9">// Guardar la carta modificada</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">rutaCarta</span><span class="hl-1"> = </span><span class="hl-7">`./cartas/</span><span class="hl-2">${</span><span class="hl-4">usuario</span><span class="hl-2">}</span><span class="hl-7">/</span><span class="hl-2">${</span><span class="hl-4">id</span><span class="hl-2">}</span><span class="hl-7">.json`</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-4">fs</span><span class="hl-1">.</span><span class="hl-3">writeFile</span><span class="hl-1">(</span><br/><span class="hl-1">          </span><span class="hl-4">rutaCarta</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-3">stringify</span><span class="hl-1">(</span><span class="hl-4">cartascoleccion</span><span class="hl-1">[</span><span class="hl-4">index</span><span class="hl-1">]),</span><br/><span class="hl-1">          (</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">err</span><span class="hl-1">) {</span><br/><span class="hl-1">              </span><span class="hl-3">callback</span><span class="hl-1">(</span><span class="hl-7">`Error al guardar la carta: </span><span class="hl-2">${</span><span class="hl-4">err</span><span class="hl-8">.</span><span class="hl-4">message</span><span class="hl-2">}</span><span class="hl-7">`</span><span class="hl-1">, </span><span class="hl-2">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">            } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-3">callback</span><span class="hl-1">(</span><br/><span class="hl-1">                </span><span class="hl-2">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-7">`Se actualizado correctamente en el usuario: </span><span class="hl-2">${</span><span class="hl-4">usuario</span><span class="hl-2">}</span><span class="hl-7"> con </span><span class="hl-2">${</span><span class="hl-4">nuevaCarta</span><span class="hl-8">.</span><span class="hl-4">id</span><span class="hl-2">}</span><span class="hl-7">`</span><span class="hl-1">,</span><br/><span class="hl-1">              );</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">          },</span><br/><span class="hl-1">        );</span><br/><br/><span class="hl-1">...</span><br/>
</code><button>Copy</button></pre>
<a id="md:como-el-guión-describe" class="tsd-anchor"></a><h3><a href="#md:como-el-guión-describe">Como el guión describe</a></h3><blockquote>
<p>Todas las peticiones deberán llevarse a cabo a partir de la ruta <code>/cards</code> y, además, deberán utilizarse los siguientes verbos HTTP para definir la manera en la que el servidor atenderá cada petición hecha en la ruta anterior:</p>
</blockquote>
<ul>
<li><p>get: Para obtener información sobre una carta de la colección de un usuario o para listar todas las cartas de su colección. En este caso, el ID de la carta vendrá dado, junto al usuario, como parámetros de la query string de la petición. Si no se especifica un ID concreto, se estará indicando que se desea obtener la colección completa de cartas del usuario.</p>
</li>
<li><p>post: Para añadir una carta a la colección de un usuario. En este caso, la carta que se desea añadir a la colección deberá venir especificada en formato JSON en el cuerpo de la petición. El usuario deberá indicarse en la query string de la petición.</p>
</li>
<li><p>delete: Para eliminar una carta de la colección de un usuario. En este caso, el ID de la carta que se desea eliminar vendrá dado, junto al usuario, como parámetros de la query string de la petición.</p>
</li>
<li><p>patch: Para modificar la información de una carta existente en la colección de un usuario. En este caso, el ID de la carta que se desea modificar vendrá dado, junto al usuario, como parámetros de la query string de la petición. Además, la información a modificar se especificará en formato JSON en el cuerpo de la petición.</p>
</li>
</ul>
<a id="md:" class="tsd-anchor"></a><h3><a href="#md:"></a></h3><p>Dando como resultado este código:</p>
<pre><code class="language-ts"><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">app</span><span class="hl-1"> = </span><span class="hl-3">express</span><span class="hl-1">();</span><br/><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-3">use</span><span class="hl-1">(</span><span class="hl-4">express</span><span class="hl-1">.</span><span class="hl-3">json</span><span class="hl-1">());</span><br/><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-3">get</span><span class="hl-1">(</span><span class="hl-7">&quot;/cards&quot;</span><span class="hl-1">, (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">usuario</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&quot;ERROR&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-7">&quot;Falta parametro de usuario en la solicitud&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">MostrarCarta</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">usuario</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-5">string</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">parseInt</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-5">string</span><span class="hl-1">),</span><br/><span class="hl-1">      (</span><span class="hl-4">error</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-3">stringify</span><span class="hl-1">({ </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&quot;ERROR&quot;</span><span class="hl-1">, </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> }));</span><br/><span class="hl-1">        } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-3">stringify</span><span class="hl-1">({ </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&quot;EXITO&quot;</span><span class="hl-1">, </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1"> }));</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">CargarCartas</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">usuario</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-5">string</span><span class="hl-1">, (</span><span class="hl-4">error</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-3">stringify</span><span class="hl-1">({ </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&quot;ERROR&quot;</span><span class="hl-1">, </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> }));</span><br/><span class="hl-1">      } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">respuesta</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1"> = </span><span class="hl-7">&quot;&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">resultado</span><span class="hl-1">: </span><span class="hl-5">Carta</span><span class="hl-1">[] = </span><span class="hl-4">result</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-5">Carta</span><span class="hl-1">[];</span><br/><span class="hl-1">        </span><span class="hl-4">resultado</span><span class="hl-1">.</span><span class="hl-3">forEach</span><span class="hl-1">((</span><span class="hl-4">carta</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">respuesta</span><span class="hl-1"> += </span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-3">stringify</span><span class="hl-1">(</span><span class="hl-4">carta</span><span class="hl-1">) + </span><span class="hl-7">&quot;</span><span class="hl-10">\n</span><span class="hl-7">&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-3">stringify</span><span class="hl-1">({ </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&quot;EXITO&quot;</span><span class="hl-1">, </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-4">respuesta</span><span class="hl-1"> }));</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-3">post</span><span class="hl-1">(</span><span class="hl-7">&quot;/cards&quot;</span><span class="hl-1">, (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">usuario</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&quot;ERROR&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-7">&quot;Falta parametro de usuario en la solicitud&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">ConversiorJSONaCarta</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, (</span><span class="hl-4">errorCarta</span><span class="hl-1">, </span><span class="hl-4">carta</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">errorCarta</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-3">stringify</span><span class="hl-1">({ </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&quot;ERROR&quot;</span><span class="hl-1">, </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-4">errorCarta</span><span class="hl-1"> }));</span><br/><span class="hl-1">      } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">GuardarCarta</span><span class="hl-1">(</span><br/><span class="hl-1">          </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">usuario</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-5">string</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">carta</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-5">Carta</span><span class="hl-1">,</span><br/><span class="hl-1">          (</span><span class="hl-4">error</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">              </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-3">stringify</span><span class="hl-1">({ </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&quot;ERROR&quot;</span><span class="hl-1">, </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> }));</span><br/><span class="hl-1">            } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-3">stringify</span><span class="hl-1">({ </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&quot;EXITO&quot;</span><span class="hl-1">, </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1"> }));</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">          },</span><br/><span class="hl-1">        );</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-3">delete</span><span class="hl-1">(</span><span class="hl-7">&quot;/cards&quot;</span><span class="hl-1">, (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">usuario</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&quot;ERROR&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-7">&quot;Falta parametro de usuario en la solicitud&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&quot;ERROR&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-7">&quot;Falta parametro de id en la solicitud&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">EliminarCarta</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">usuario</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-5">string</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">parseInt</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-5">string</span><span class="hl-1">),</span><br/><span class="hl-1">      (</span><span class="hl-4">error</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-3">stringify</span><span class="hl-1">({ </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&quot;ERROR&quot;</span><span class="hl-1">, </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> }));</span><br/><span class="hl-1">        } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-3">stringify</span><span class="hl-1">({ </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&quot;EXITO&quot;</span><span class="hl-1">, </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1"> }));</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-3">patch</span><span class="hl-1">(</span><span class="hl-7">&quot;/cards&quot;</span><span class="hl-1">, (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">usuario</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&quot;ERROR&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-7">&quot;Falta parametro de usuario en la solicitud&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&quot;ERROR&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-7">&quot;Falta parametro de id en la solicitud&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-9">// Verifica si el id en el cuerpo coincide con el id en la cadena de consulta</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-3">parseInt</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-5">string</span><span class="hl-1">) !== </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&quot;ERROR&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">answer:</span><br/><span class="hl-1">          </span><span class="hl-7">&quot;La identificación en el cuerpo debe ser la misma que la de la cadena de consulta.&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-9">// Llama a la función para modificar la carta</span><br/><span class="hl-1">    </span><span class="hl-3">ConversiorJSONaCarta</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, (</span><span class="hl-4">errorCarta</span><span class="hl-1">, </span><span class="hl-4">carta</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">errorCarta</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-3">stringify</span><span class="hl-1">({ </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&quot;ERROR&quot;</span><span class="hl-1">, </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-4">errorCarta</span><span class="hl-1"> }));</span><br/><span class="hl-1">      } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-3">MostrarCartas</span><span class="hl-1">(</span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-3">stringify</span><span class="hl-1">(</span><span class="hl-4">carta</span><span class="hl-1">)));</span><br/><span class="hl-1">        </span><span class="hl-3">ActualizarCarta</span><span class="hl-1">(</span><br/><span class="hl-1">          </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">usuario</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-5">string</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-3">parseInt</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-5">string</span><span class="hl-1">),</span><br/><span class="hl-1">          </span><span class="hl-4">carta</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-5">Carta</span><span class="hl-1">,</span><br/><span class="hl-1">          (</span><span class="hl-4">error</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">              </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-3">stringify</span><span class="hl-1">({ </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&quot;ERROR&quot;</span><span class="hl-1">, </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> }));</span><br/><span class="hl-1">            } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-3">send</span><span class="hl-1">(</span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-3">stringify</span><span class="hl-1">({ </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&quot;EXITO&quot;</span><span class="hl-1">, </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1"> }));</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">          },</span><br/><span class="hl-1">        );</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-3">listen</span><span class="hl-1">(</span><span class="hl-11">3000</span><span class="hl-1">, () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-7">&quot;El servidor está activo en el puerto 3000.&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Se procede a explicar la estructura que sigo en las peticiones HTTP con Express en este caso es una estructura clara y bien organizada que sigue los principios de enrutamiento y manejo de solicitudes de Express.</p>
<p>En primer lugar, inicializamos una instancia de Express para crear nuestro servidor. Luego, establecemos una ruta en <strong>./cards</strong> para manejar diversas solicitudes HTTP.</p>
<p>Asociamos diferentes tipos de solicitudes con esta ruta para realizar acciones específicas. Es decir, inspeccionamos los parámetros de la <strong>query string</strong> para determinar qué acción tomar.</p>
<p>Para la solicitud GET, verificamos el número de parámetros en la query string para discernir entre realizar la acción de <code>MostrarCarta</code> o <code>CargarCartas</code>. Si se busca visualizar una carta específica, examinamos el campo <strong>&#39;id&#39;</strong> en la <strong>query string</strong> para identificarla.</p>
<p>Todas las respuestas del servidor están en formato JSON y siguen la misma estructura
<code>{ status, answer }</code>.
El campo <strong>status</strong>: indica si la operación fue exitosa o si ocurrió un error.
El campo <strong>answer</strong>: proporciona detalles adicionales o el resultado de la operación, en el caso de las solicitudes GET donde se llama a la funcion <strong>JSON.stringify</strong> objeto <code>Carta</code> o <code>Carta[]</code> en una cadena JSON.</p>
<p>He implementado una función denominada <code>ConversiorJSONaCarta</code> con el propósito de convertir objetos JSON provenientes del <strong>body</strong> de las solicitudes en instancias de la clase Carta. Esta abstracción resulta sumamente útil para gestionar datos en formato JSON en las solicitudes entrantes del servidor, facilitando así su manipulación como objetos dentro del código. Este enfoque, además de proporcionar una mayor robustez a la aplicación, simplifica el proceso de recepción y manipulación de datos.</p>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-3">ConversiorJSONaCarta</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-9">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span><br/><span class="hl-1">  </span><span class="hl-4">nueva_carta</span><span class="hl-1">: </span><span class="hl-5">any</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-3">callback</span><span class="hl-1">: (</span><span class="hl-4">error</span><span class="hl-1">: </span><span class="hl-5">Error</span><span class="hl-1"> | </span><span class="hl-5">undefined</span><span class="hl-1">, </span><span class="hl-4">carta</span><span class="hl-1">: </span><span class="hl-5">Carta</span><span class="hl-1"> | </span><span class="hl-5">undefined</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-5">void</span><span class="hl-1">,</span><br/><span class="hl-1">): </span><span class="hl-5">void</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-7">`Creando carta que contiene </span><span class="hl-2">${</span><span class="hl-4">nueva_carta</span><span class="hl-8">.</span><span class="hl-4">id</span><span class="hl-2">}</span><span class="hl-7">`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">cartas_magicas</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-3">Carta</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-4">nueva_carta</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">nueva_carta</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">nueva_carta</span><span class="hl-1">.</span><span class="hl-4">coste_mana</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">nueva_carta</span><span class="hl-1">.</span><span class="hl-4">color</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">nueva_carta</span><span class="hl-1">.</span><span class="hl-4">lineatipo</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">nueva_carta</span><span class="hl-1">.</span><span class="hl-4">rareza</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">nueva_carta</span><span class="hl-1">.</span><span class="hl-4">reglas</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">nueva_carta</span><span class="hl-1">.</span><span class="hl-4">fuerza</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">nueva_carta</span><span class="hl-1">.</span><span class="hl-4">Resistencia</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">nueva_carta</span><span class="hl-1">.</span><span class="hl-4">loyalty</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">nueva_carta</span><span class="hl-1">.</span><span class="hl-4">valor_mercado</span><span class="hl-1">,</span><br/><span class="hl-1">    );</span><br/><br/><span class="hl-1">    </span><span class="hl-3">callback</span><span class="hl-1">(</span><span class="hl-2">undefined</span><span class="hl-1">, </span><span class="hl-4">cartas_magicas</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">callback</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">, </span><span class="hl-2">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Y por ultimo se realizo las prubas unitarias de los distintas peticiones con request.</p>
<pre><code class="language-ts"><span class="hl-3">describe</span><span class="hl-1">(</span><span class="hl-7">&quot;Pruebas de las rutas de la aplicación Express&quot;</span><span class="hl-1">, () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-9">// Prueba para la ruta GET /cards</span><br/><span class="hl-1">  </span><span class="hl-3">it</span><span class="hl-1">(</span><span class="hl-7">&quot;Test 1 - get (no debería funcionar si el usuario no se da en la query string)&quot;</span><span class="hl-1">, (</span><span class="hl-4">done</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-3">get</span><span class="hl-1">(</span><br/><span class="hl-1">      { </span><span class="hl-4">url:</span><span class="hl-1"> </span><span class="hl-7">&quot;http://localhost:3000/cards&quot;</span><span class="hl-1">, </span><span class="hl-4">json:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1"> },</span><br/><span class="hl-1">      (</span><span class="hl-4">error</span><span class="hl-1">: </span><span class="hl-5">Error</span><span class="hl-1">, </span><span class="hl-4">response</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">expect</span><span class="hl-1">(</span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">status</span><span class="hl-1">).</span><span class="hl-4">to</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-7">&quot;ERROR&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-3">expect</span><span class="hl-1">(</span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">answer</span><span class="hl-1">).</span><span class="hl-4">to</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><br/><span class="hl-1">          </span><span class="hl-7">&quot;Falta parametro de usuario en la solicitud&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        );</span><br/><span class="hl-1">        </span><span class="hl-3">done</span><span class="hl-1">();</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-3">it</span><span class="hl-1">(</span><span class="hl-7">&quot;Test 2 - get (debería obtener todas las cartas de un usuario)&quot;</span><span class="hl-1">, (</span><span class="hl-4">done</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-3">get</span><span class="hl-1">(</span><br/><span class="hl-1">      { </span><span class="hl-4">url:</span><span class="hl-1"> </span><span class="hl-7">&quot;http://localhost:3000/cards?usuario=eva&quot;</span><span class="hl-1">, </span><span class="hl-4">json:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1"> },</span><br/><span class="hl-1">      (</span><span class="hl-4">error</span><span class="hl-1">: </span><span class="hl-5">Error</span><span class="hl-1">, </span><span class="hl-4">response</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">expect</span><span class="hl-1">(</span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">status</span><span class="hl-1">).</span><span class="hl-4">to</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-7">&quot;EXITO&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-1">        </span><span class="hl-3">done</span><span class="hl-1">();</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-3">it</span><span class="hl-1">(</span><span class="hl-7">&quot;Test 3 - get (debería obtener una carta de un usuario)&quot;</span><span class="hl-1">, (</span><span class="hl-4">done</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-3">get</span><span class="hl-1">(</span><br/><span class="hl-1">      { </span><span class="hl-4">url:</span><span class="hl-1"> </span><span class="hl-7">&quot;http://localhost:3000/cards?usuario=eva&amp;id=6&quot;</span><span class="hl-1">, </span><span class="hl-4">json:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1"> },</span><br/><span class="hl-1">      (</span><span class="hl-4">error</span><span class="hl-1">: </span><span class="hl-5">Error</span><span class="hl-1">, </span><span class="hl-4">response</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">expect</span><span class="hl-1">(</span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">status</span><span class="hl-1">).</span><span class="hl-4">to</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-7">&quot;EXITO&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-3">done</span><span class="hl-1">();</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-9">// Prueba para la ruta POST /cards</span><br/><span class="hl-1">  </span><span class="hl-3">it</span><span class="hl-1">(</span><span class="hl-7">&quot;Test 4 - post (no debería funcionar si el usuario no se da en la query string)&quot;</span><span class="hl-1">, (</span><span class="hl-4">done</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-3">post</span><span class="hl-1">(</span><br/><span class="hl-1">      { </span><span class="hl-4">url:</span><span class="hl-1"> </span><span class="hl-7">&quot;http://localhost:3000/cards&quot;</span><span class="hl-1">, </span><span class="hl-4">json:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1"> },</span><br/><span class="hl-1">      (</span><span class="hl-4">error</span><span class="hl-1">: </span><span class="hl-5">Error</span><span class="hl-1">, </span><span class="hl-4">response</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">expect</span><span class="hl-1">(</span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">status</span><span class="hl-1">).</span><span class="hl-4">to</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-7">&quot;ERROR&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-3">expect</span><span class="hl-1">(</span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">answer</span><span class="hl-1">).</span><span class="hl-4">to</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><br/><span class="hl-1">          </span><span class="hl-7">&quot;Falta parametro de usuario en la solicitud&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        );</span><br/><span class="hl-1">        </span><span class="hl-3">done</span><span class="hl-1">();</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-3">it</span><span class="hl-1">(</span><span class="hl-7">&quot;Test 5 - post (debería añadir una carta a un usuario)&quot;</span><span class="hl-1">, (</span><span class="hl-4">done</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">cardToAdd</span><span class="hl-1"> = {</span><br/><span class="hl-1">      </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-11">7</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">nombre:</span><span class="hl-1"> </span><span class="hl-7">&quot;Pokemon-Pikachu&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">costemana:</span><span class="hl-1"> </span><span class="hl-11">5</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">color:</span><span class="hl-1"> </span><span class="hl-7">&quot;Rojo&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">lineatipo:</span><span class="hl-1"> </span><span class="hl-7">&quot;Instantaneo&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">rareza:</span><span class="hl-1"> </span><span class="hl-7">&quot;Rara&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">reglas:</span><br/><span class="hl-1">        </span><span class="hl-7">&quot;Objetivo del juego: El objetivo principal es reducir los puntos de vida del oponente a cero. Cada jugador comienza con 20 puntos de vida&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">valorMercado:</span><span class="hl-1"> </span><span class="hl-11">50</span><span class="hl-1">,</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">    </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-3">post</span><span class="hl-1">(</span><br/><span class="hl-1">      { </span><span class="hl-4">url:</span><span class="hl-1"> </span><span class="hl-7">&quot;http://localhost:3000/cards?usuario=eva&quot;</span><span class="hl-1">, </span><span class="hl-4">json:</span><span class="hl-1"> </span><span class="hl-4">cardToAdd</span><span class="hl-1"> },</span><br/><span class="hl-1">      (</span><span class="hl-4">error</span><span class="hl-1">: </span><span class="hl-5">Error</span><span class="hl-1">, </span><span class="hl-4">response</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">expect</span><span class="hl-1">(</span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">.</span><span class="hl-4">status</span><span class="hl-1">).</span><span class="hl-4">to</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-7">&quot;EXITO&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-3">done</span><span class="hl-1">();</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  ...</span>
</code><button>Copy</button></pre>
<a id="md:conclusion" class="tsd-anchor"></a><h1><a href="#md:conclusion">Conclusion</a></h1><p>En conclusion, está práctica me ha ayudado a entender la imprementación de servidor HTTP utilizando Express, asímismo he entendido el significado y la aplicación práctica de los distintos verbos HTTP(GET,POST, DELETE, PATCH), así como la importancia de emplear adecuadamente el patrón callback siendo más estructurada y facil de redirigir información de salida al cliente. </p>
<p>Una de las dificultades qe me encontre durante la realización de la práctica fue la conversion formato JSON en objetos de tipo <code>Carta</code>. Inicialmente, no estaba claro por qué se requería un conversor para realizar esta tarea, y tuve dificultades ya que no se me guardaba nada solo se creaba el fichero. Y no sabia como implementarlo asi que busque recursos y supe realizar el ejercicio.</p>
<a id="md:bibliografia" class="tsd-anchor"></a><h1><a href="#md:bibliografia">Bibliografia</a></h1><p><a href="https://stackoverflow.com/questions/72723644/parsing-body-from-request-to-class-in-express">https://stackoverflow.com/questions/72723644/parsing-body-from-request-to-class-in-express</a></p>
<p><a href="https://nodejs.org/docs/latest/api/fs.html">https://nodejs.org/docs/latest/api/fs.html</a></p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:práctica-11---aplicación-express-para-coleccionistas-de-cartas-magic"><span>Práctica 11 -<wbr/> <wbr/>Aplicación <wbr/>Express para coleccionistas de cartas <wbr/>Magic</span></a><ul><li><a href="#md:indice"><span>Indice</span></a></li><li><a href="#md:introducción"><span>Introducción</span></a></li><li><a href="#md:desarrollo-de-la-práctica"><span>Desarrollo de la práctica</span></a></li><li><ul><li><a href="#md:como-el-guión-describe"><span>Como el guión describe</span></a></li><li><a href="#md:"><span></span></a></li></ul></li></ul><a href="#md:conclusion"><span>Conclusion</span></a><a href="#md:bibliografia"><span>Bibliografia</span></a></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="index.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>ull-esit-inf-dsi-23-24-prct11-http-express-magic-app-angelaizquiierdo</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>